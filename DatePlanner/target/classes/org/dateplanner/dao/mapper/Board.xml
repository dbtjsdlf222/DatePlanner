<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.dateplanner.dao.BoardDAO">
  
  <insert id="insertPost" parameterType="Post">
    INSERT INTO
      board(title, content, image, lat, lng, user_no, region_no, packageable)
    VALUES
      (#{title}, #{content}, #{image}, #{lat}, #{lng}, #{user.no}, #{regionNo}, #{packageable})
  </insert>
  
  <insert id="insertPackage" parameterType="Post" keyProperty="no" useGeneratedKeys="true">
    INSERT INTO
      board(title, content, image, user_no, region_no)
    VALUES
      (#{title}, #{content}, #{image}, #{user.no}, #{regionNo})
  </insert>
  
  <select id="checkPackageable" parameterType="Package" resultType="int">
    SELECT
      COUNT(*)
    FROM
      board
    WHERE
      ((packageable IS NOT NULL AND user_no = #{packagePost.user.no})
    OR
      packageable = true)
    AND
      no IN(<foreach collection="placeList" item="place" separator=", ">#{place.no}</foreach>)
  </select>
  
  <select id="selectOne" parameterType="int" resultType="Post">
    SELECT
      b.no, title, content, image, lat, lng, user_no, b.region_no regionNo, packageable, b.regdate,
      u.no 'user.no', nickname 'user.nickname'
    FROM
      board b
    JOIN
      users u
    ON
      user_no = u.no
    WHERE
      b.no = #{no}
  </select>
  
  <select id="selectAll" resultType="Post">
    SELECT
      b.no, title, content, image, lat, lng, user_no, b.region_no regionNo, packageable, b.regdate,
      u.no 'user.no', nickname 'user.nickname'
    FROM
      board b
    JOIN
      users u
    ON
      user_no = u.no
    ORDER BY
      regdate DESC
  </select>
  
  <select id="selectPackageable" parameterType="int" resultType="Post">
    SELECT
      no, title, content, image, lat, lng, user_no 'user.no', region_no regionNo, packageable, regdate
    FROM
      board
    WHERE
      ((packageable IS NOT NULL AND user_no = #{packagePost.user.no})
    OR
      packageable = true)
  </select>
  
  <select id="selectMyPage" parameterType="int" resultType="Post">
	SELECT
	  b.no, title, content, image, lat, lng, user_no, b.region_no regionNo, packageable, b.regdate,
      u.no 'user.no', nickname 'user.nickname'
    FROM
      board b
    JOIN
      users u
    ON
      user_no = u.no
    ORDER BY b.regdate desc
   	limit 8
  </select>
  
</mapper>